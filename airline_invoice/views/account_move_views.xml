<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend invoice form to show Airline fields -->
    <record id="view_move_form_airline_invoice" model="ir.ui.view">
        <field name="name">account.move.form.airline.invoice</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Print button only for Airline Invoice -->
            <xpath expr="//header" position="inside">
                <button name="%(airline_invoice.action_report_airline_invoice)d"
                        type="action"
                        string="Print Airline Invoice"
                        class="btn-secondary"
                        invisible="not is_airline_invoice"/>
            </xpath>

            <!-- Add flag (hidden) -->
            <xpath expr="//sheet" position="inside">
                <field name="is_airline_invoice" invisible="1"/>
            </xpath>

            <!-- Add Airline totals block near totals -->
            <xpath expr="//field[@name='tax_totals']" position="before">
                <group class="oe_subtotal_footer">
                    <field name="is_airline_invoice" invisible="1"/>
                    <field name="airline_total_basic_fare" readonly="1" nolabel="0" invisible="not is_airline_invoice"/>
                    <field name="airline_total_vat" readonly="1" invisible="not is_airline_invoice"/>
                    <field name="airline_total_taxes" readonly="1" invisible="not is_airline_invoice"/>
                    <field name="airline_total_baq_protect" readonly="1" invisible="not is_airline_invoice"/>
                    <field name="airline_total_bill_diff" readonly="1" invisible="not is_airline_invoice"/>
                    <field name="airline_total_ins_premium" readonly="1" invisible="not is_airline_invoice"/>
                    <field name="airline_grand_total" readonly="1" invisible="not is_airline_invoice"/>
                </group>
            </xpath>

            <!-- Invoice lines list: add airline columns after account_id (support both <list> and <tree>) -->
            <xpath expr="//field[@name='invoice_line_ids']//*[self::list or self::tree]//field[@name='account_id']" position="after">
                <field name="is_airline_invoice" invisible="1"/>
                <field name="air_ticket_no" optional="show" column_invisible="not is_airline_invoice or display_type"/>
                <field name="air_pax_name" optional="show" column_invisible="not is_airline_invoice or display_type"/>
                <field name="air_basic_fare" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="air_vat_amount" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="air_taxes_amount" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="air_baq_protect" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="air_bill_diff" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="air_ins_premium" optional="show" column_invisible="not is_airline_invoice or display_type" widget="monetary" options="{'currency_field': 'currency_id'}"/>
            </xpath>

            <!-- Invoice lines form (mobile): add airline fields after account_id -->
            <xpath expr="//field[@name='invoice_line_ids']//form//field[@name='account_id']" position="after">
                <field name="is_airline_invoice" invisible="1"/>
                <field name="display_type" invisible="1"/>
                <group>
                    <field name="air_ticket_no" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_pax_name" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_basic_fare" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_vat_amount" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_taxes_amount" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_baq_protect" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_bill_diff" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                    <field name="air_ins_premium" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="not is_airline_invoice or display_type"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>


